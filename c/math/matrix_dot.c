#include <Ubject.h>

#include "../core/base.h"
#define NODE_PROTECTED
#define VAR_PROTECTED
#include "matrix_dot.r.h"

//////////////////////////////////////////////////////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////////////////////////////////////////////////////
/// Static function declarations
//////////////////////////////////////////////////////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////////////////////////////////////////////////////

#define STATIC_FUNC_DECL

static void *solve_matrix_dot(struct laud_matrix_dot *matrix_dot);

#undef STATIC_FUNC_DECL

//////////////////////////////////////////////////////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////////////////////////////////////////////////////
/// Class Initializer
//////////////////////////////////////////////////////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////////////////////////////////////////////////////

#define CLASS_INIT

const void *LaudMatrixDot = NULL;
const void *LaudMatrixDotClass = NULL;

static void __attribute__((constructor(LAUD_MATRIX_DOT_PRIORITY)))
library_initializer(void) {
  if (!LaudMatrixDotClass) {
    LaudMatrixDotClass = LaudVarClass;
  }
  if (!LaudMatrixDot) {
    LaudMatrixDot = init(LaudMatrixDotClass, LaudVar,
                         sizeof(struct laud_matrix_dot),  // class parent size
                         className, "LaudMatrixDot",      // class name
                         evaluate_node, solve_matrix_dot, // evaluate_node
                         //  ctor, laud_matrix_dot_ctor,        // construtor
                         //  dtor, laud_matrix_dot_dtor,        // destrutor
                         NULL);
  }
}

#undef CLASS_INIT

//////////////////////////////////////////////////////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////////////////////////////////////////////////////
/// Implemention
//////////////////////////////////////////////////////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////////////////////////////////////////////////////

#define IMPL

static void *solve_matrix_dot(struct laud_matrix_dot *matrix_dot) {
  return laud_matrix_dot(
      narray((struct laud_var *)incoming_nodes(matrix_dot)[0]),
      narray((struct laud_var *)incoming_nodes(matrix_dot)[1]));
}